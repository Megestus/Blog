import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as i,d as e,f as s,o as t}from"./app-COS9OrFJ.js";const r={},d=e("blockquote",null,[e("p",null,"迁移一下文章到当前博客，记录下使用群晖nas搭建内外穿透的方案。")],-1),l=s(`<p> </p><p>方案采用云服务器挂载nps内网穿透和npm反向代理，代理内网网站和服务。</p><h2 id="一、泛域名解析" tabindex="-1"><a class="header-anchor" href="#一、泛域名解析"><span><strong>一、泛域名解析</strong></span></a></h2><p>申请购买-自己的域名 备案 + 等待 周期大概15天左右。<br> 域名可以在腾讯或者阿里云等申请购买-搞便宜的就好</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>域名到期后不续费，记得申请注销掉域名主体，避免非法分子利用域名做非法勾当。</p></div><p><a href="https://buy.cloud.tencent.com/domain?intl=0" target="_blank" rel="noopener noreferrer">域名注册购买_域名注册选购 - 腾讯云</a></p><p>然后在域名后添加DNS解析 * 代表了泛解析 ，二级域名随便写。 <code>ark.</code> <code>[megestu.top]</code> (<a href="http://ark.megestu.top" target="_blank" rel="noopener noreferrer">http://ark.megestu.top</a>) ark. 就是二级域名啦</p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215175909.png" style="width:95% !important;"></div><p> </p><h2 id="二、服务器安装docker和docker-compose" tabindex="-1"><a class="header-anchor" href="#二、服务器安装docker和docker-compose"><span><strong>二、服务器安装docker和docker-compose</strong></span></a></h2><blockquote><p>这一步-直接使用docker镜像服务器-或者自己使用Linux系统安装也可以，<br>我自己使用Docker <code>Ubuntu 20.01 LTS</code> ，免去部署docker的环节。</p></blockquote><h3 id="使用官方安装脚本自动安装docker" tabindex="-1"><a class="header-anchor" href="#使用官方安装脚本自动安装docker"><span><strong>使用官方安装脚本自动安装docker</strong></span></a></h3><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>curl -fsSL https://test.docker.com -o test-docker.sh

sudo sh test-docker.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完成，输入命令 查看版本</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>docker --vrsion
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="接着安装docker-compose" tabindex="-1"><a class="header-anchor" href="#接着安装docker-compose"><span><strong>接着安装docker-compose</strong></span></a></h3><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>sudo curl -L &quot;https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完成，输入命令 查看版本</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>docker-compose --version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p> </p><h2 id="三、为docker安装可视化portainer面板" tabindex="-1"><a class="header-anchor" href="#三、为docker安装可视化portainer面板"><span><strong>三、为docker安装可视化Portainer面板</strong></span></a></h2><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code># 下载镜像
docker pull portainer/portainer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code># 运行portainerUI图形界面
# -d后台运行 --name 命名 -p 端口映射(需要确认端口号是开放的) -v挂载
docker run -d --restart=always --name portainerUI -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过服务器ip:9000进入DOCKER面板</p><p> </p><h2 id="四、安装nps内网穿透面板" tabindex="-1"><a class="header-anchor" href="#四、安装nps内网穿透面板"><span>四、安装NPS内网穿透面板</span></a></h2><p>nps是一款轻量级、高性能、功能强大的内网穿透代理服务器。目前支持tcp、udp流量转发，可支持任何tcp、udp上层协议（访问内网网站、本地支付接口调试、ssh访问、远程桌面，内网dns解析等等……），此外还支持内网http代理、内网socks5代理、p2p等，并带有功能强大的web管理端。</p><p>项目地址： <a href="https://github.com/ehang-io/nps" target="_blank" rel="noopener noreferrer">https://github.com/ehang-io/nps</a></p><hr><p>回到根目录</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>cd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建nps文件夹</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>mkdir nps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进入nps文件夹</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>cd nps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>下载压缩包</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>wget https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>解压包</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>tar -zxvf linux_amd64_server.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进入配置文件夹conf</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>cd conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>编辑配置文件</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>vi nps.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将里面的80和443修改为8080和4443</p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240310155627.png" style="width:80% !important;"></div><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215180608.png" style="width:60% !important;"></div><p>在下方也可以指定web端口和账号密码-我这里改成了8081</p><p>退回到/nps 目录-执行安装</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>sudo ./nps install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动NSP</p><div class="language-linux line-numbers-mode" data-ext="linux" data-title="linux"><pre class="language-linux"><code>sudo nps start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p> </p><h2 id="五、安装nginx-proxy-manager反向代理" tabindex="-1"><a class="header-anchor" href="#五、安装nginx-proxy-manager反向代理"><span>五、安装Nginx Proxy Manager反向代理</span></a></h2><p>进入Nginx Proxy Manager官网，获取docker-compose.yml配置文件<br><a href="https://nginxproxymanager.com/" target="_blank" rel="noopener noreferrer">https://nginxproxymanager.com/</a></p><p>中文版本<br><a href="https://github.com/goodmen001/nginx-proxy-manager-zh?tab=readme-ov-file" target="_blank" rel="noopener noreferrer">https://github.com/goodmen001/nginx-proxy-manager-zh?tab=readme-ov-file</a></p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215180950.png" style="width:100% !important;"></div><div class="language-compose line-numbers-mode" data-ext="compose" data-title="compose"><pre class="language-compose"><code>version: &#39;3.8&#39;
services:
  app:
    image: &#39;jc21/nginx-proxy-manager:latest&#39;
    restart: unless-stopped
    ports:
      - &#39;80:80&#39;
      - &#39;81:81&#39;
      - &#39;443:443&#39;
    volumes:
      - ./data:/data                  
      - ./letsencrypt:/etc/letsencrypt
      
   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这里面的80:80，指的是-本地端口:容器端口；服务器中的防火墙80 、 443是默认开放的。建议本地端口改为不冲突的端口。 映射路径最好改为自建的路径 如果使用的有家庭公网IP，需要修改下端口，因为家庭宽宽公网IP封了80和443端口，那么以上代码端口号部分需要修改.</p></blockquote><p> </p><h3 id="打开portainer面板-进行安装nginx-proxy-manager" tabindex="-1"><a class="header-anchor" href="#打开portainer面板-进行安装nginx-proxy-manager"><span>打开Portainer面板，进行安装Nginx Proxy Manager</span></a></h3><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181049.png" style="width:100% !important;"></div><p>通过<code>&lt;服务器IP&gt;:81</code>进入npm后台进行基本的配置;</p><blockquote><p><strong>初始npm的账号密码</strong></p></blockquote><p>Email: <code>admin@example.com</code><br> Password: <code>changeme</code></p><p> </p><h2 id="六、内网穿透-nas端" tabindex="-1"><a class="header-anchor" href="#六、内网穿透-nas端"><span>六、内网穿透-Nas端</span></a></h2><p><strong>通过服务器IP:8081端口进入NPS后台</strong></p><h3 id="_1-新增客户端" tabindex="-1"><a class="header-anchor" href="#_1-新增客户端"><span>1.新增客户端</span></a></h3><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181210.png" style="width:100% !important;"></div><p>增加完成后 复制其中服务器地址 和 密钥，客户端进行连接后-后这里的状态就会显示为在线。</p><p>到<code>群晖套件中心</code>安装NPS的客户端。</p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181222.png" style="width:100% !important;"></div><p>输入服务器地址 和 密钥 然后保存即可。</p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181243.png" style="width:70% !important;"></div><p> </p><h3 id="_2-内网穿透tcp隧道" tabindex="-1"><a class="header-anchor" href="#_2-内网穿透tcp隧道"><span>2.内网穿透TCP隧道</span></a></h3><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181538.png" style="width:100% !important;"></div><p>➕新增</p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181553.png" style="width:100% !important;"></div><p>建立完成隧道后就去npm 进行反向代理并给个二级域名</p><p> </p><h3 id="_3-npm反向代理" tabindex="-1"><a class="header-anchor" href="#_3-npm反向代理"><span>3.npm反向代理</span></a></h3><p>改完密码后-就新建代理</p><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181700.png" style="width:100% !important;"></div><div class="image-preview"><img src="https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215181714.png" style="width:50% !important;"></div><p>强制SSL就行了 、HTTP/2 建议不要开-不然注册不了。</p><div class="hint-container note"><p class="hint-container-title">注</p><p>注意一下：每个二级域名网页都需要单独申请SSL证书</p></div>`,87);function o(c,p){return t(),a("div",null,[d,i(" more "),l])}const g=n(r,[["render",o],["__file","NPS_NPM.html.vue"]]),v=JSON.parse('{"path":"/server/docker/NPS_NPM.html","title":"NPS内网穿透+NPM反向代理","lang":"zh-CN","frontmatter":{"title":"NPS内网穿透+NPM反向代理","icon":"iconfont alicon-a-nginxproxymanager-1331550891378311340","category":"docker","tags":["docker","nas"],"date":"2023-10-15T00:00:00.000Z","cover":"https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215184340.png","description":"迁移一下文章到当前博客，记录下使用群晖nas搭建内外穿透的方案。","head":[["meta",{"property":"og:url","content":"https:///about.md/blog/server/docker/NPS_NPM.html"}],["meta",{"property":"og:site_name","content":"Megestus"}],["meta",{"property":"og:title","content":"NPS内网穿透+NPM反向代理"}],["meta",{"property":"og:description","content":"迁移一下文章到当前博客，记录下使用群晖nas搭建内外穿透的方案。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215184340.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-07T17:21:45.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215184340.png"}],["meta",{"name":"twitter:image:alt","content":"NPS内网穿透+NPM反向代理"}],["meta",{"property":"article:author","content":"Megestus"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"nas"}],["meta",{"property":"article:published_time","content":"2023-10-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-07T17:21:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"NPS内网穿透+NPM反向代理\\",\\"image\\":[\\"https://megestus-1309556466.cos.ap-shanghai.myqcloud.com/img/20240215184340.png\\"],\\"datePublished\\":\\"2023-10-15T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-07T17:21:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Megestus\\",\\"url\\":\\"https://github.com/Megestus\\"}]}"]]},"headers":[{"level":2,"title":"一、泛域名解析","slug":"一、泛域名解析","link":"#一、泛域名解析","children":[]},{"level":2,"title":"二、服务器安装docker和docker-compose","slug":"二、服务器安装docker和docker-compose","link":"#二、服务器安装docker和docker-compose","children":[{"level":3,"title":"使用官方安装脚本自动安装docker","slug":"使用官方安装脚本自动安装docker","link":"#使用官方安装脚本自动安装docker","children":[]},{"level":3,"title":"接着安装docker-compose","slug":"接着安装docker-compose","link":"#接着安装docker-compose","children":[]}]},{"level":2,"title":"三、为docker安装可视化Portainer面板","slug":"三、为docker安装可视化portainer面板","link":"#三、为docker安装可视化portainer面板","children":[]},{"level":2,"title":"四、安装NPS内网穿透面板","slug":"四、安装nps内网穿透面板","link":"#四、安装nps内网穿透面板","children":[]},{"level":2,"title":"五、安装Nginx Proxy Manager反向代理","slug":"五、安装nginx-proxy-manager反向代理","link":"#五、安装nginx-proxy-manager反向代理","children":[{"level":3,"title":"打开Portainer面板，进行安装Nginx Proxy Manager","slug":"打开portainer面板-进行安装nginx-proxy-manager","link":"#打开portainer面板-进行安装nginx-proxy-manager","children":[]}]},{"level":2,"title":"六、内网穿透-Nas端","slug":"六、内网穿透-nas端","link":"#六、内网穿透-nas端","children":[{"level":3,"title":"1.新增客户端","slug":"_1-新增客户端","link":"#_1-新增客户端","children":[]},{"level":3,"title":"2.内网穿透TCP隧道","slug":"_2-内网穿透tcp隧道","link":"#_2-内网穿透tcp隧道","children":[]},{"level":3,"title":"3.npm反向代理","slug":"_3-npm反向代理","link":"#_3-npm反向代理","children":[]}]}],"git":{"createdTime":1711204216000,"updatedTime":1723051305000,"contributors":[{"name":"Megestus","email":"2624203622@qq.com","commits":3}]},"filePathRelative":"server/docker/NPS&NPM.md","localizedDate":"2023年10月15日","excerpt":"<blockquote>\\n<p>迁移一下文章到当前博客，记录下使用群晖nas搭建内外穿透的方案。</p>\\n</blockquote>\\n","autoDesc":true}');export{g as comp,v as data};
